<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ex.repository.BoardMapper">
<!-- 
	mapper namespace ì†ì„±
	.XMLì´ ì—°ê²°ë  Mapperì¸í„°í˜ì´ìŠ¤ì˜ í’€ë„¤ì„(íŒ¨í‚¤ì§€ëª…+í´ë˜ìŠ¤ëª…) ê²½ë¡œ ì‘ì„±.
	
	íƒœê·¸ ë‚´ ì†ì„±
	id				: ëª¨ë“  íƒœê·¸ì˜ ê³ ìœ ì´ë¦„ ì§€ì •
					: Mapper Interfaceì˜ ë©”ì„œë“œëª…
	parameterType	: ì „ë‹¬ë°›ëŠ” íŒŒë¼ë¯¸í„°ì˜ í´ë˜ìŠ¤ ê²½ë¡œ
					: insert/update/deleteì—ì„œ ìƒëµ ê°€ëŠ¥.
	resultType		: ê²°ê³¼ íƒ€ì…
					: selectì—ì„œ ë°˜ë“œì‹œ ì‘ì„±.
					: ì»¬ëŸ¼ëª…ê³¼ DTO í•„ë“œëª…ì´ ë™ì¼í•´ì•¼ ìë™ ë§¤í•‘.
	: com.ex.date.BoardDTO	í’€ë„¤ì„ ì‘ì„±
	: í´ë˜ìŠ¤ëª…ë§Œ ì‘ì„±í•  ì‹œ ì¶”ê°€ ì„¤ì • í•„ìš”.

-->
<!--
	<sql id="ê³µí†µ"> ì¬ì‚¬ìš© í•˜ê¸° ìœ„í•œ íƒœê·¸.
	ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë  ì¡°ê±´ì„ ë¹¼ë‘” ê²ƒ.
	ì£¼ë¡œ ì¡°ê±´ë¬¸(WHERE, ORDER BY ë“±)ì„ ì¬ì‚¬ìš©í•  ë•Œ ìœ ìš©í•¨.
	<include refid="ê³µí†µ"> íƒœê·¸ë¡œ ì ìš©í•œë‹¤.
-->

	<!-- ê¸€ì‘ì„± ì‹œ í•„ìš”í•œ ì¿¼ë¦¬ 3ê°œ -->
	<!-- 1. nvl(ì»¬ëŸ¼, ê°’) : nullì¼ ë•Œ ì²˜ë¦¬ -->
	<select id="maxNum" resultType="int">
		select NVL(max(num), 0) from board
	</select>
	
	<!-- 2. ë‹µê¸€(insert) ì‹œ, ê¸°ì¡´ ê¸€ë“¤ì˜ re_stepì„ +1 í•˜ì—¬
	ìƒˆ ê¸€ì„ ê°€ì¥ ìœ„ë¡œ ë°°ì¹˜í•˜ê³  ê¸°ì¡´ ê¸€ì€ í•œ ì¹¸ì”© ì•„ë˜ë¡œ ë‚´ë¦¬ëŠ” ì²˜ë¦¬. -->
	<update id="reStepUp">
		update board set re_step=re_step+1 where ref=#{ref} and re_step > #{re_step}
	</update>
	
	<!-- 3. ê¸€ì‘ì„±,  parameterType ìƒëµ	MyBatisê°€ íŒŒë¼ë¯¸í„° íƒ€ì…ì„ ìë™ ì¶”ë¡  -->
	<insert id="boardInsert">
		insert into board values( board_seq.nextval, #{writer}, #{title}, #{content}, #{pw}, 0, #{ref}, #{re_level}, #{re_step}, sysdate)
	</insert>

	<!-- ê¸€ê°œìˆ˜ -->
	<select id="boardCount" resultType="int">
		select count(*) from board
	</select>

	<!-- ê¸€ëª©ë¡ -->
	<select id="boardList" resultType="com.ex.data.BoardDTO">
		<![CDATA[
		select * from ( select b.*, rownum r from 
				( select * from board order by ref desc, re_step asc ) b )
				where r >= #{start} and r <= #{end}
		]]>
	</select>
<!--	
	<![CDATA[ ]]>  ì”¨ ë°ì´í„°
	CDATAëŠ” Character Dataì˜ ì•½ìë¡œ, 
	íŠ¹ìˆ˜ë¬¸ì <, > ë“±ì„ íƒœê·¸ë¡œ ì¸ì‹í•˜ì§€ ì•Šë„ë¡ ë°©ì§€
	
	ğŸ” ë™ì‘
	í˜ì´ì§• ì²˜ë¦¬ëœ ê¸€ ëª©ë¡ ì¡°íšŒ
	order by ref desc, re_step asc
	â†’ ref ì—­ìˆœ(ìµœì‹  ê¸€ ë¨¼ì €), re_step ì˜¤ë¦„ì°¨ìˆœ(ë‹µê¸€ ìˆœì„œ)
	
	1. íŠ¹ìˆ˜ ë¬¸ì ì²˜ë¦¬
	XMLì—ì„œëŠ” <, >, &ì™€ ê°™ì€ íŠ¹ìˆ˜ ë¬¸ìê°€ ì˜ˆì•½ë˜ì–´ ìˆì–´ ì¼ë°˜ì ìœ¼ë¡œ ì“¸ ìˆ˜ ì—†ìŒ.
	XML íŒŒì„œê°€ ì´ë¥¼ íƒœê·¸ë¡œ ì¸ì‹í•˜ë ¤ê³  í•´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.
	CDATAë¥¼ ì‚¬ìš©í•˜ë©´ ë‚´ë¶€ì˜ ë‚´ìš©ì„ XML íŒŒì„œê°€ í•´ì„í•˜ì§€ ì•Šê³  í…ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬í•¨.
	2. ê°€ë…ì„±
	SQL ì¿¼ë¦¬ì™€ ê°™ì€ ê¸´ ë¬¸ìì—´ì„ í¬í•¨í•  ë•Œ 
	CDATAë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œê°€ ë” ê¹”ë”í•˜ê³  ì½ê¸° ì‰¬ì›€.	-->
	
	<!-- ê³µí†µ ì¿¼ë¦¬ ë¹¼ë‘ê¸° -->
	<sql id="whereNum">
		where num=#{num}
	</sql>
	
	<!-- ì¡°íšŒìˆ˜ +1 -->
	<update id="readCountUp">
		update board set readCount=readCount+1 <include refid="whereNum"></include>
	</update>
	
	<!-- num(ê²Œì‹œê¸€ ë²ˆí˜¸)ë¡œ í•´ë‹¹ ê¸€ì˜ ìƒì„¸ ë‚´ìš© ì¡°íšŒ. -->
	<select id="boardContent" resultType="com.ex.data.BoardDTO">
		select * from board 
		<include refid="whereNum"></include>
	</select>

	<!-- ê¸€ ìˆ˜ì • -->
	<update id="boardUpdate">
		update board set writer=#{writer}, title=#{title}, content=#{content}, pw=#{pw} 
		<include refid="whereNum"/>
	</update>
	
	<!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
	<select id="pwCheck" resultType="String">
		select pw from board <include refid="whereNum"/>
	</select>
	
	<!-- ê¸€ ì‚­ì œ -->
	<delete id="boardDelete">
		delete from board where <include refid="whereNum"></include>
	</delete>
</mapper>